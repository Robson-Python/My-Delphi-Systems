unit CadMedida_frm;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, Grids, StdCtrls, Buttons, ExtCtrls, DBGrids, DBCtrls;

type
  TfrmCadMed = class(TForm)
    Panel1: TPanel;
    btnNovo: TSpeedButton;
    btnSair: TSpeedButton;
    GroupBox1: TGroupBox;
    DBGrid1: TDBGrid;
    DBNavigator1: TDBNavigator;
    Shape1: TShape;
    procedure btnNovoClick(Sender: TObject);
    procedure btnSairClick(Sender: TObject);
    procedure FormShow(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  frmCadMed: TfrmCadMed;

implementation

uses Carro_Comando_dm, ADODB, DB, Principal_frm;

{$R *.dfm}


function fBuscaCodMed() : Integer;
begin
    With dmVendas.ADOQuery1 do begin
       Active := False;
       SQL.Clear;
       SQL.Add('Select Count(*) as ultimo from medidas');
       Active := True;
       fBuscaCodMed := FieldByName('ultimo').AsInteger;
    end;
end;


procedure TfrmCadMed.btnNovoClick(Sender: TObject);
var nNovo : Integer;
begin
//    If frmPrincipal.StatusBar1.Panels[2].Text = 'Nível:Alto' then begin
       With dmVendas.ADOQuery1 do begin
          Active := False;
          SQL.Clear;
          SQL.Add('Select * from medidas');
          Active := True;
          If dmVendas.ADOQuery1.RecordCount = fBuscaCodMed then
             nNovo := fBuscaCodMed + 1
          else
             nNovo := fBuscaCodMed;
          end;
       With dmVendas.ADOQuery1 do begin
          Active := False;
          SQL.Clear;
          SQL.Add('Insert into medidas (med_cod, med_nome, med_simb) Values ('+IntToStr(nNovo)+', '''', '''')');
          ExecSQL;
          FormShow(Sender);
       end;
//    end
//    else begin
//       Application.MessageBox('Seu nível de acesso é Baixo. Você não tem permissão para executar esse comando!','Carro Comando - Atenção',MB_OK+MB_ICONSTOP);
//    end;
end;

procedure TfrmCadMed.btnSairClick(Sender: TObject);
begin
    With dmVendas.ADOQuery1 do begin
       Active := False;
       SQL.Clear;
    end;
    Close;
end;


procedure TfrmCadMed.FormShow(Sender: TObject);
begin
    With dmVendas.ADOQuery1 do begin
       Active := False;
       SQL.Clear;
       SQL.Add('Select * from medidas order by med_cod');
       Active := True;
       DBGrid1.Columns.Items[0].FieldName := FieldByName('med_cod').FieldName;
       DBGrid1.Columns.Items[1].FieldName := FieldByName('med_nome').FieldName;
       DBGrid1.Columns.Items[2].FieldName := FieldByName('med_simb').FieldName;
       Last;
       DBGrid1.Columns.Items[0].Color := clMoneyGreen;
    end;
end;

end.
